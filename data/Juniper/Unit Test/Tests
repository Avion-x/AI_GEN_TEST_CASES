 ###STARTLIST###
[
  {"testname":"Bootup Test 1",
   "testcase":{
     "testname":"Bootup Test 1",
     "objective":"Verify bootup process completes successfully within expected time",
     "steps":["Device boots up in under 5 minutes","All processes start without errors","Management interface comes up"]
   }, 
   "testscript":{
     "testname":"Bootup Test 1",
     "objective":"Verify bootup process completes successfully within expected time",
     "file_name":"bootup_test1.py",
     "init_scripts":[
       "pip install paramiko"
     ],
     "script":"""      
import paramiko
import time

DEVICE_IP = '10.1.1.1'
USERNAME = 'admin'
PASSWORD = 'juniper123'

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

print("Connecting to device...")
ssh.connect(DEVICE_IP, username=USERNAME, password=PASSWORD)

start = time.time()

print("Waiting for device to finish booting...")
while True:
  if time.time() - start > 300:
    raise Exception("Bootup took longer than 5 minutes")
  
  stdin, stdout, stderr = ssh.exec_command("show chassis routing-engine")
  output = stdout.read().decode()

  if "Online" in output:
    print("Bootup finished successfully")
    break

  time.sleep(10)

print("Management interface validation...")  
stdin, stdout, stderr = ssh.exec_command("show interfaces terse | match mgmt")
output = stdout.read().decode()

if "up" in output:
  print("Management interface is up")
else:
  raise Exception("Management interface did not come up")

ssh.close()

print("Test passed")    
     """
   ,
   "run_command":"python3 bootup_test1.py",
   "expected_result":"Test passed"
   }
 },
 {"testname":"Bootup Test 2",
  "testcase":{
    "testname":"Bootup Test 2",  
    "objective":"Verify all key processes come up without errors",
    "steps":["Check log for errors","Verify key processes are running"]
  },
  "testscript":{
    "testname":"Bootup Test 2",
    "objective":"Verify all key processes come up without errors", 
    "file_name":"bootup_test2.py",
    "init_scripts":[
      "pip install paramiko"
    ],
    "script":"""
import paramiko

DEVICE_IP = '10.1.1.1'
USERNAME = 'admin'
PASSWORD = 'juniper123'

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

print("Connecting to device...")
ssh.exec_command("start shell pfe network fpc0")

print("Checking log for errors...")
stdin, stdout, stderr = ssh.exec_command("show log messages | match error")
errors = stdout.read().decode().strip()

if errors:
  print("Errors found in log:")
  print(errors)
  raise Exception("Errors found in log")
else:
  print("No errors found in log")  

print("Verifying processes...")
stdin, stdout, stderr = ssh.exec_command("show system processes extensive")
output = stdout.read().decode()

if "rpd" not in output:
  raise Exception("RPD process not running")

if "dfwd" not in output:
  raise Exception("DFWD process not running")  

print("Key processes verified successfully")

ssh.close()
print("Test passed")
    """,
    "run_command":"python3 bootup_test2.py",
    "expected_result":"Test passed"
  }
}]
###ENDLIST###