 ###STARTLIST###
[
  {
    "testname": "Test LACP Link Aggregation",
    "testcase": {
      "testname": "Test LACP Link Aggregation",  
      "objective": "Verify LACP link aggregation functionality",
      "steps": [
        "Configure LACP link aggregation on ports ge-0/0/1 and ge-0/0/2",
        "Verify LACP neighbor is established",
        "Send traffic across link aggregation and verify traffic forwarding"
      ],
      "testdata": {
        "lacp_interfaces": ["ge-0/0/1", "ge-0/0/2"],
        "peer_ip": "192.168.1.2"
      }
    },
    "testscript": {
      "testname": "Test LACP Link Aggregation",
      "objective": "Automate LACP link aggregation test case",
      "file_name": "test_lacp.py",
      "init_scripts": [
        "pip install junos-eznc",
        "pip install paramiko"
       ],
      "script": """
        import jnpr.junos
        import unittest
        
        dev = jnpr.junos.Device(host='192.168.1.1', user='john', password='secret123')
        dev.open()
        
        lacp_ports = {{lacp_interfaces}}
        
        dev.cli('set interfaces ' + str(lacp_ports[0]) + ' ether-options 802.3ad ' + str(lacp_ports[1]))
        dev.cli('set protocols lacp interfaces ' + str(lacp_ports[0]) + ' link-protection')
        
        result = dev.cli('show lacp interfaces')
        assert 'Aggregated interface: ae0' in result
        
        dev.cli('ping ' + {{peer_ip}})
        
        dev.close()
      """,
      "run_command": "python test_lacp.py",
      "expected_result": "LACP neighbor established and traffic passes"
    }
  },

  {
    "testname": "Test LACP Failure Detection",
    "testcase": {
      "testname": "Test LACP Failure Detection",
      "objective": "Verify LACP failure detection and failover",
      "steps": [
        "Configure LACP between two links", 
        "Shut down one link",
        "Verify traffic fails over to remaining link"
      ],
      "testdata": {
        "lacp_links": ["ge-0/0/1", "ge-0/0/2"],
        "shut_interface": "ge-0/0/1"  
      }
    },
    "testscript": {
      "testname": "Test LACP Failure Detection",
      "objective": "Automate LACP failure test case",
      "file_name": "test_lacp_failover.py",
      "init_scripts": [
        "pip install junos-eznc",
        "pip install paramiko"
      ],
      "script": """
        import jnpr.junos
        import time
        import unittest
        
        dev = jnpr.junos.Device(host='192.168.1.1', user='john', password='secret123')
        dev.open()
        
        lacp_ports = {{lacp_links}}
        
        dev.cli('set interfaces ' + str(lacp_ports[0]) + ' ether-options 802.3ad ' + str(lacp_ports[1]))
        dev.cli('set protocols lacp interfaces ' + str(lacp_ports[0]) + ' link-protection')
        
        dev.cli('ping 192.168.1.2')
        
        dev.cli('deactivate interfaces ' + {{shut_interface}})
        time.sleep(5)
        
        result = dev.cli('ping 192.168.1.2')
        assert '!!!' not in result
        
        dev.close()
      """,
      "run_command": "python test_lacp_failover.py", 
      "expected_result": "Traffic fails over after link shutdown"
    }

  }
]
###ENDLIST###