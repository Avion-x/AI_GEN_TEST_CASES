 ###STARTLIST###
[
  {
    "testname": "QoS Marking Test", 
    "testcase": {
      "testname": "QoS Marking Test",
      "objective": "Verify that traffic is marked correctly with QoS values", 
      "steps": [
        "Configure QoS policy to mark VoIP traffic to DSCP 46",
        "Generate VoIP traffic from client", 
        "Verify VoIP traffic is marked with DSCP 46 on the router interface"
      ],
      "test_data": {
        "voip_source_ip": "192.168.1.5",
        "voip_destination_ip": "10.1.1.2",
        "voip_dscp_value": 46
      }
    },
    "testscript": {
      "testname": "QoS Marking Script",
      "objective": "Automate QoS Marking Test",
      "file_name": "qos_marking_test.py",
      "init_scripts": [
        "pip install paramiko",
        "pip install netmiko"  
      ],
      "script": """
        import paramiko
        import netmiko
        
        ROUTER_IP = '192.168.1.1'
        ROUTER_USERNAME = 'admin'
        ROUTER_PASSWORD = 'passwd'
        
        ssh_client = paramiko.SSHClient()
        ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh_client.connect(hostname=ROUTER_IP,username=ROUTER_USERNAME,password=ROUTER_PASSWORD)
        
        conn = ssh_client.invoke_shell()
        
        conn.send("configure terminal\\n")
        conn.send("policy-map VOIP_POLICY\\n")
        conn.send("class VOIP\\n")
        conn.send("set dscp 46\\n")
        conn.send("exit\\n")
        
        conn.send("interface ge-0/0/0\\n")
        conn.send("service-policy input VOIP_POLICY\\n")
        conn.send("end\\n")
        
        net_connect = netmiko.ConnectHandler(ip=ROUTER_IP, username=ROUTER_USERNAME, password=ROUTER_PASSWORD)
        output = net_connect.send_command("show policy-options policy-statement VOIP_POLICY")
        
        if "dscp 46" in output:
          print("QoS Marking Test Passed")
        else:
          print("QoS Marking Test Failed")
        
        ssh_client.close()
      """,
      "run_command": "python qos_marking_test.py",
      "expected_result": "QoS Marking Test Passed"
    }
  }
]
###ENDLIST###