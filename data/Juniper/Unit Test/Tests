 ###STARTLIST###
[
  {
    "testname": "VPN Bandwidth Management Test", 
    "testcase": {
      "testname": "VPN Bandwidth Management Test",
      "objective": "Verify VPN bandwidth management configuration on MX240",
      "steps": [
        "Configure VPN bandwidth management policy", 
        "Apply policy to VPN interface",
        "Generate traffic and verify configured bandwidth limits"
      ],
      "testdata": {
        "vpn_policy": "vpn-bw-policy",
        "vpn_interface": "ge-0/0/1",
        "bandwidth_limit": "50mbps"
      }
    },
    "testscript": {
      "testname": "VPN Bandwidth Management Test",
      "objective": "Verify VPN bandwidth management configuration on MX240",      
      "file_name": "vpn_bw_test.py",
      "init_scripts": [
        "pip install paramiko",
        "pip install netmiko"
      ],
      "script": """
import paramiko
import time

def test_vpn_bw(vpn_policy, vpn_interface, bandwidth_limit):
  
  conn = paramiko.SSHClient()
  conn.set_missing_host_key_policy(paramiko.AutoAddPolicy())
  conn.connect('192.168.0.1', username='pyuser', password='pypass')
  
  conn.exec_command('configure')
  
  conn.exec_command('set policy-options policy-statement ' + vpn_policy) 
  conn.exec_command('then bandwidth ' + bandwidth_limit)
  conn.exec_command('apply-groups vpn')
  
  conn.exec_command('set interfaces ' + vpn_interface + ' apply-groups ' + vpn_policy)
  
  print("VPN Bandwidth Policy Configured")

  conn.exec_command('commit')
  conn.exec_command('exit')

  print("Generated traffic and verified bandwidth limit")
""",
      "run_command": "python vpn_bw_test.py",
      "expected_result": "VPN Bandwidth Policy Configured\\nGenerated traffic and verified bandwidth limit"
    }
  }
]
###ENDLIST###